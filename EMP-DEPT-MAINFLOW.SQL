CONN SYS/123@//LOCALHOST:1523/ORCLDOCKER AS SYSDBA; 

ALTER SESSION SET "_ORACLE_SCRIPT" = TRUE;

CREATE USER EMP_DEPT_MANAGEMENT IDENTIFIED BY 123 QUOTA 50M ON USERS ;
GRANT CONNECT TO EMP_DEPT_MANAGEMENT; 
GRANT ALL PRIVILEGES TO EMP_DEPT_MANAGEMENT;
ALTER SESSION SET CURRENT_SCHEMA = EMP_DEPT_MANAGEMENT;

-- CREATE CLUSTER 
CREATE CLUSTER EMP_DEPT (DEPTNO NUMBER(3)) 
    SIZE 600
    STORAGE (
        INITIAL 200K 
        NEXT 300K
        MINEXTENTS 2
        PCTINCREASE 33
    );

-- CREATE INDEX CLUSTER 

CREATE INDEX emp_dept_index 
   ON CLUSTER emp_dept 
   STORAGE (INITIAL 50K 
      NEXT 50K 
      MINEXTENTS 2 
      MAXEXTENTS 10 
      PCTINCREASE 33
    );

-- CREATE CLUSTER TABLE 

CREATE TABLE dept (  
   deptno NUMBER(3) PRIMARY KEY)  
   CLUSTER emp_dept (deptno) ;

CREATE TABLE empl (  
   emplno NUMBER(5) PRIMARY KEY,  
   emplname VARCHAR2(15) NOT NULL,  
   deptno NUMBER(3) REFERENCES dept (DEPTNO))  
   CLUSTER emp_dept (deptno);



-- CREATE 100 DEPARTMENT ; 
INSERT INTO DEPT (DEPTNO)
    SELECT LEVEL
    FROM DUAL
    CONNECT BY LEVEL <= 100;
COMMIT;

-- CREATE 100K EMPLOYEES; 
INSERT INTO EMPL (EMPLNO,EMPLNAME,DEPTNO)
    SELECT 
        TRUNC(LEVEL),
        'EMP'|| LEVEL, 
        TRUNC(DBMS_RANDOM.VALUE(1,101))
    FROM DUAL
    CONNECT BY LEVEL < 100000;

SET AUTOTRACE TRACE STAT
SELECT /* ATTEMP 2*/ EMPL.* FROM EMPL , DEPT WHERE EMPL.DEPTNO = DEPT.DEPTNO AND DEPT.DEPTNO = 1;


CREATE TABLE dept2 (  
   deptno NUMBER(3) PRIMARY KEY)  
;

CREATE TABLE empl2 (  
   emplno NUMBER(5) PRIMARY KEY,  
   emplname VARCHAR2(15) NOT NULL,  
   deptno NUMBER(3) REFERENCES dept2 (DEPTNO))  
;

INSERT INTO dept2
SELECT * FROM DEPT;

INSERT INTO EMPL2
SELECT * FROM EMPL;

SET AUTOTRACE TRACE STAT
SELECT /* ATTEMP */ EMPL2.* FROM EMPL2 , DEPT2 WHERE EMPL2.DEPTNO = DEPT2.DEPTNO AND DEPT2.DEPTNO = 1;
